<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ssgtarbucks.persistence.QRCodeRepository">

	<select id="joinStroagebyQRCodeIdToSearch" parameterType="_int"
		resultType="StorageDTO">
		SELECT
			i.item_id, i.item_code,i.item_exp,p.product_id,	p.product_name,
		p.product_standard,	p.product_unit,	p.product_spec,	p.category_id,	q.qrcode_id,
		q.qrcode_date,s.stock_id,	s.stock_date, s.branch_id, s.stock_quantity,
		sl.location_id,	sl.location_code,sl.location_area, sl.location_section,
		sl.location_section_name,sl.location_column, sl.location_row, sl.location_alias
		FROM item i 
			join product p on p.product_id = i.product_id
			join stock s on s.item_id =	i.item_id
			join stock_location sl on sl.location_id = s.location_id
			join qrcode q on q.qrcode_id = i.qrcode_id
		WHERE q.qrcode_id = #{qrcode_id}
	</select>
	
	
	<!-- 보관장소등록 QRCode -->
	<insert id="insertQrcodeToRegisterLocation" parameterType="QRCodeDTO">
		INSERT INTO qrcode(qrcode_path,qrcode_date,qrcode_type,qrcode_value)
			VALUES (#{qrcode_path},(select curdate()),#{qrcode_type},#{qrcode_value});
	</insert>
	
	<!-- QR코드 qrcode_id(primary key)가져오기 -->
	<select  id="selectQrcodeIdToFind" parameterType="String" resultType="_int">
		select qrcode_id from qrcode where qrcode_value=#{qrcode_value};
	</select>
	
	<!-- StockLocaiton테이블 qrcode_id 삽입ㅡ -->
	<update id="updateLocationToAddQrcodeId" parameterType="StockLocationDTO">
		update stock_location 
			set qrcode_id = #{qrcode_id}
		    where location_code=#{location_code};
	</update>
	
	<select id="selectProductByBranchId" resultType="ProductDTO" parameterType="String">
		select 
			p.product_code,
			p.product_name,
		    p.product_standard,
		    p.product_unit,
		    c.category_name,
		    p.product_spec,
		    i.item_id,
		    i.item_code,
			i.item_exp,
		    i.qrcode_id,
		    s.stock_quantity,
		    s.stock_date,
		    img.image_id,
		    img.image_path
		from product p 
		join item i on p.product_id = i.product_id
		join stock s on s.item_id = i.item_id
		join image img on img.image_id = p.image_id
		join category c on c.category_id = p.category_id
		where s.branch_id = #{branch_id} and i.item_code=#{item_code}
	</select>
	
</mapper>



